function preSimulation(iteration)
% variables
n_variance = [1e-2; 1e-1; 1e0; 1e1; 1e2];
num_sample = 11;
dt=0.1;
F = [1 0;0 1];

Anchor = struct(...
    'a1',[0;10],...
    'a2',[0;0],...
    'a3',[10;0],...
    'a4',[10;10]...
    );

LSE = struct(...
    'var001',zeros(2,iteration,num_sample),...
    'var01',zeros(2,iteration,num_sample),...
    'var1',zeros(2,iteration,num_sample),...
    'var10',zeros(2,iteration,num_sample),...
    'var100',zeros(2,iteration,num_sample)...
    );
R = struct(...
    'var001',zeros(6,6,iteration,num_sample),...
    'var01',zeros(6,6,iteration,num_sample),...
    'var1',zeros(6,6,iteration,num_sample),...
    'var10',zeros(6,6,iteration,num_sample),...
    'var100',zeros(6,6,iteration,num_sample)...
    );

Z = struct(...
    'var001',zeros(6,1,iteration,num_sample),...
    'var01',zeros(6,1,iteration,num_sample),...
    'var1',zeros(6,1,iteration,num_sample),...
    'var10',zeros(6,1,iteration,num_sample),...
    'var100',zeros(6,1,iteration,num_sample)...
    );

vec_processNoise = struct(...
    'var001', zeros(2,iteration),...
    'var01', zeros(2,iteration),...
    'var1', zeros(2,iteration),...
    'var10', zeros(2,iteration),...
    'var100', zeros(2,iteration)...
    );


for iter = 1:iteration
    for num = 1:num_sample
        exactPos = [num-1;num-1];
        meas_dn_001(:,1) = ...
            [...
            norm(exactPos-Anchor.a1)+sqrt(n_variance(1,1))*randn...
            norm(exactPos-Anchor.a2)+sqrt(n_variance(1,1))*randn...
            norm(exactPos-Anchor.a3)+sqrt(n_variance(1,1))*randn...
            norm(exactPos-Anchor.a4)+sqrt(n_variance(1,1))*randn
            ];

        meas_dn_01(:,1) = ...
            [...
            norm(exactPos-Anchor.a1)+sqrt(n_variance(2,1))*randn...
            norm(exactPos-Anchor.a2)+sqrt(n_variance(2,1))*randn...
            norm(exactPos-Anchor.a3)+sqrt(n_variance(2,1))*randn...
            norm(exactPos-Anchor.a4)+sqrt(n_variance(2,1))*randn
            ];

        meas_dn_1(:,1) = ...
            [...
            norm(exactPos-Anchor.a1)+sqrt(n_variance(3,1))*randn...
            norm(exactPos-Anchor.a2)+sqrt(n_variance(3,1))*randn...
            norm(exactPos-Anchor.a3)+sqrt(n_variance(3,1))*randn...
            norm(exactPos-Anchor.a4)+sqrt(n_variance(3,1))*randn
            ];

        meas_dn_10(:,1) = ...
            [...
            norm(exactPos-Anchor.a1)+sqrt(n_variance(4,1))*randn...
            norm(exactPos-Anchor.a2)+sqrt(n_variance(4,1))*randn...
            norm(exactPos-Anchor.a3)+sqrt(n_variance(4,1))*randn...
            norm(exactPos-Anchor.a4)+sqrt(n_variance(4,1))*randn
            ];

        meas_dn_100(:,1) = ...
            [...
            norm(exactPos-Anchor.a1)+sqrt(n_variance(5))*randn,...
            norm(exactPos-Anchor.a2)+sqrt(n_variance(5))*randn,...
            norm(exactPos-Anchor.a3)+sqrt(n_variance(5))*randn,...
            norm(exactPos-Anchor.a4)+sqrt(n_variance(5))*randn
            ];

        [LSE.var001(:,iter,num), Z.var001(:,1,iter,num)] = ToA(meas_dn_001);
        [LSE.var01(:,iter,num), Z.var01(:,1,iter,num)] = ToA(meas_dn_01);
        [LSE.var1(:,iter,num), Z.var1(:,1,iter,num)] = ToA(meas_dn_1);
        [LSE.var10(:,iter,num),Z.var10(:,1,iter,num)] = ToA(meas_dn_10);
        [LSE.var100(:,iter,num),Z.var100(:,1,iter,num)] = ToA(meas_dn_100);

        R.var001(:,:,iter,num) = [4*n_variance(1,1)*(meas_dn_001(1,1)^2+meas_dn_001(2,1)^2) 4*n_variance(1,1)*(meas_dn_001(1,1)^2) 4*n_variance(1,1)*(meas_dn_001(1,1)^2) -4*n_variance(1,1)*(meas_dn_001(2,1)^2) -4*n_variance(1,1)*(meas_dn_001(2,1)^2) 0;...
            4*n_variance(1,1)*(meas_dn_001(1,1)^2) 4*n_variance(1,1)*(meas_dn_001(1,1)^2+meas_dn_001(3,1)^2) 4*n_variance(1,1)*(meas_dn_001(1,1)^2) 4*n_variance(1,1)*(meas_dn_001(3,1)^2) 0 -4*n_variance(1,1)*(meas_dn_001(3,1)^2);...
            4*n_variance(1,1)*(meas_dn_001(1,1)^2) 4*n_variance(1,1)*(meas_dn_001(1,1)^2) 4*n_variance(1,1)*(meas_dn_001(1,1)^2+meas_dn_001(4,1)^2) 0 4*n_variance(1,1)*(meas_dn_001(4,1)^2) 4*n_variance(1,1)*(meas_dn_001(4,1)^2);...
            -4*n_variance(1,1)*(meas_dn_001(2,1)^2) 4*n_variance(1,1)*(meas_dn_001(3,1)^2) 0 4*n_variance(1,1)*(meas_dn_001(2,1)^2+meas_dn_001(3,1)^2) 4*n_variance(1,1)*(meas_dn_001(2,1)^2) -4*n_variance(1,1)*(meas_dn_001(3,1)^2);...
            -4*n_variance(1,1)*(meas_dn_001(2,1)^2) 0 4*n_variance(1,1)*(meas_dn_001(4,1)^2) 4*n_variance(1,1)*(meas_dn_001(2,1)^2) 4*n_variance(1,1)*(meas_dn_001(2,1)^2+meas_dn_001(4,1)^2) 4*n_variance(1,1)*(meas_dn_001(4,1)^2);...
            0 -4*n_variance(1,1)*(meas_dn_001(3,1)^2) 4*n_variance(1,1)*(meas_dn_001(4,1)^2) -4*n_variance(1,1)*(meas_dn_001(3,1)^2) 4*n_variance(1,1)*(meas_dn_001(4,1)^2) 4*n_variance(1,1)*(meas_dn_001(3,1)^2+meas_dn_001(4,1)^2)
            ];

        R.var01(:,:,iter,num) = [4*n_variance(2,1)*(meas_dn_01(1,1)^2+meas_dn_01(2,1)^2) 4*n_variance(2,1)*(meas_dn_01(1,1)^2) 4*n_variance(2,1)*(meas_dn_01(1,1)^2) -4*n_variance(2,1)*(meas_dn_01(2,1)^2) -4*n_variance(2,1)*(meas_dn_01(2,1)^2) 0;...
            4*n_variance(2,1)*(meas_dn_01(1,1)^2) 4*n_variance(2,1)*(meas_dn_01(1,1)^2+meas_dn_01(3,1)^2) 4*n_variance(2,1)*(meas_dn_01(1,1)^2) 4*n_variance(2,1)*(meas_dn_01(3,1)^2) 0 -4*n_variance(2,1)*(meas_dn_01(3,1)^2);...
            4*n_variance(2,1)*(meas_dn_01(1,1)^2) 4*n_variance(2,1)*(meas_dn_01(1,1)^2) 4*n_variance(2,1)*(meas_dn_01(1,1)^2+meas_dn_01(4,1)^2) 0 4*n_variance(2,1)*(meas_dn_01(4,1)^2) 4*n_variance(2,1)*(meas_dn_01(4,1)^2);...
            -4*n_variance(2,1)*(meas_dn_01(2,1)^2) 4*n_variance(2,1)*(meas_dn_01(3,1)^2) 0 4*n_variance(2,1)*(meas_dn_01(2,1)^2+meas_dn_01(3,1)^2) 4*n_variance(2,1)*(meas_dn_01(2,1)^2) -4*n_variance(2,1)*(meas_dn_01(3,1)^2);...
            -4*n_variance(2,1)*(meas_dn_01(2,1)^2) 0 4*n_variance(2,1)*(meas_dn_01(4,1)^2) 4*n_variance(2,1)*(meas_dn_01(2,1)^2) 4*n_variance(2,1)*(meas_dn_01(2,1)^2+meas_dn_01(4,1)^2) 4*n_variance(2,1)*(meas_dn_01(4,1)^2);...
            0 -4*n_variance(2,1)*(meas_dn_01(3,1)^2) 4*n_variance(2,1)*(meas_dn_01(4,1)^2) -4*n_variance(2,1)*(meas_dn_01(3,1)^2) 4*n_variance(2,1)*(meas_dn_01(4,1)^2) 4*n_variance(2,1)*(meas_dn_01(3,1)^2+meas_dn_01(4,1)^2)
            ];

        R.var1(:,:,iter,num) = [4*n_variance(3,1)*(meas_dn_1(1,1)^2+meas_dn_1(2,1)^2) 4*n_variance(3,1)*(meas_dn_1(1,1)^2) 4*n_variance(3,1)*(meas_dn_1(1,1)^2) -4*n_variance(3,1)*(meas_dn_1(2,1)^2) -4*n_variance(3,1)*(meas_dn_1(2,1)^2) 0;...
            4*n_variance(3,1)*(meas_dn_1(1,1)^2) 4*n_variance(3,1)*(meas_dn_1(1,1)^2+meas_dn_1(3,1)^2) 4*n_variance(3,1)*(meas_dn_1(1,1)^2) 4*n_variance(3,1)*(meas_dn_1(3,1)^2) 0 -4*n_variance(3,1)*(meas_dn_1(3,1)^2);...
            4*n_variance(3,1)*(meas_dn_1(1,1)^2) 4*n_variance(3,1)*(meas_dn_1(1,1)^2) 4*n_variance(3,1)*(meas_dn_1(1,1)^2+meas_dn_1(4,1)^2) 0 4*n_variance(3,1)*(meas_dn_1(4,1)^2) 4*n_variance(3,1)*(meas_dn_1(4,1)^2);...
            -4*n_variance(3,1)*(meas_dn_1(2,1)^2) 4*n_variance(3,1)*(meas_dn_1(3,1)^2) 0 4*n_variance(3,1)*(meas_dn_1(2,1)^2+meas_dn_1(3,1)^2) 4*n_variance(3,1)*(meas_dn_1(2,1)^2) -4*n_variance(3,1)*(meas_dn_1(3,1)^2);...
            -4*n_variance(3,1)*(meas_dn_1(2,1)^2) 0 4*n_variance(3,1)*(meas_dn_1(4,1)^2) 4*n_variance(3,1)*(meas_dn_1(2,1)^2) 4*n_variance(3,1)*(meas_dn_1(2,1)^2+meas_dn_1(4,1)^2) 4*n_variance(3,1)*(meas_dn_1(4,1)^2);...
            0 -4*n_variance(3,1)*(meas_dn_1(3,1)^2) 4*n_variance(3,1)*(meas_dn_1(4,1)^2) -4*n_variance(3,1)*(meas_dn_1(3,1)^2) 4*n_variance(3,1)*(meas_dn_1(4,1)^2) 4*n_variance(3,1)*(meas_dn_1(3,1)^2+meas_dn_1(4,1)^2)
            ];

        R.var10(:,:,iter,num) = [4*n_variance(1,1)*(meas_dn_10(1,1)^2+meas_dn_10(2,1)^2) 4*n_variance(4,1)*(meas_dn_10(1,1)^2) 4*n_variance(4,1)*(meas_dn_10(1,1)^2) -4*n_variance(4,1)*(meas_dn_10(2,1)^2) -4*n_variance(4,1)*(meas_dn_10(2,1)^2) 0;...
            4*n_variance(4,1)*(meas_dn_10(1,1)^2) 4*n_variance(4,1)*(meas_dn_10(1,1)^2+meas_dn_10(3,1)^2) 4*n_variance(4,1)*(meas_dn_10(1,1)^2) 4*n_variance(4,1)*(meas_dn_10(3,1)^2) 0 -4*n_variance(4,1)*(meas_dn_10(3,1)^2);...
            4*n_variance(4,1)*(meas_dn_10(1,1)^2) 4*n_variance(4,1)*(meas_dn_10(1,1)^2) 4*n_variance(4,1)*(meas_dn_10(1,1)^2+meas_dn_10(4,1)^2) 0 4*n_variance(4,1)*(meas_dn_10(4,1)^2) 4*n_variance(4,1)*(meas_dn_10(4,1)^2);...
            -4*n_variance(4,1)*(meas_dn_10(2,1)^2) 4*n_variance(4,1)*(meas_dn_10(3,1)^2) 0 4*n_variance(4,1)*(meas_dn_10(2,1)^2+meas_dn_10(3,1)^2) 4*n_variance(4,1)*(meas_dn_10(2,1)^2) -4*n_variance(4,1)*(meas_dn_10(3,1)^2);...
            -4*n_variance(4,1)*(meas_dn_10(2,1)^2) 0 4*n_variance(4,1)*(meas_dn_10(4,1)^2) 4*n_variance(4,1)*(meas_dn_10(2,1)^2) 4*n_variance(4,1)*(meas_dn_10(2,1)^2+meas_dn_10(4,1)^2) 4*n_variance(4,1)*(meas_dn_10(4,1)^2);...
            0 -4*n_variance(4,1)*(meas_dn_10(3,1)^2) 4*n_variance(4,1)*(meas_dn_10(4,1)^2) -4*n_variance(4,1)*(meas_dn_10(3,1)^2) 4*n_variance(4,1)*(meas_dn_10(4,1)^2) 4*n_variance(4,1)*(meas_dn_10(3,1)^2+meas_dn_10(4,1)^2)
            ];

        R.var100(:,:,iter,num) = [4*n_variance(5,1)*(meas_dn_100(1,1)^2+meas_dn_100(2,1)^2) 4*n_variance(5,1)*(meas_dn_100(1,1)^2) 4*n_variance(5,1)*(meas_dn_100(1,1)^2) -4*n_variance(5,1)*(meas_dn_100(2,1)^2) -4*n_variance(5,1)*(meas_dn_100(2,1)^2) 0;...
            4*n_variance(5,1)*(meas_dn_100(1,1)^2) 4*n_variance(5,1)*(meas_dn_100(1,1)^2+meas_dn_100(3,1)^2) 4*n_variance(5,1)*(meas_dn_100(1,1)^2) 4*n_variance(5,1)*(meas_dn_100(3,1)^2) 0 -4*n_variance(5,1)*(meas_dn_100(3,1)^2);...
            4*n_variance(5,1)*(meas_dn_100(1,1)^2) 4*n_variance(5,1)*(meas_dn_100(1,1)^2) 4*n_variance(5,1)*(meas_dn_100(1,1)^2+meas_dn_100(4,1)^2) 0 4*n_variance(5,1)*(meas_dn_100(4,1)^2) 4*n_variance(5,1)*(meas_dn_100(4,1)^2);...
            -4*n_variance(5,1)*(meas_dn_100(2,1)^2) 4*n_variance(5,1)*(meas_dn_100(3,1)^2) 0 4*n_variance(5,1)*(meas_dn_100(2,1)^2+meas_dn_100(3,1)^2) 4*n_variance(5,1)*(meas_dn_100(2,1)^2) -4*n_variance(5,1)*(meas_dn_100(3,1)^2);...
            -4*n_variance(5,1)*(meas_dn_100(2,1)^2) 0 4*n_variance(5,1)*(meas_dn_100(4,1)^2) 4*n_variance(5,1)*(meas_dn_100(2,1)^2) 4*n_variance(5,1)*(meas_dn_100(2,1)^2+meas_dn_100(4,1)^2) 4*n_variance(5,1)*(meas_dn_100(4,1)^2);...
            0 -4*n_variance(5,1)*(meas_dn_100(3,1)^2) 4*n_variance(5,1)*(meas_dn_100(4,1)^2) -4*n_variance(5,1)*(meas_dn_100(3,1)^2) 4*n_variance(5,1)*(meas_dn_100(4,1)^2) 4*n_variance(5,1)*(meas_dn_100(3,1)^2+meas_dn_100(4,1)^2)
            ];

    end
    k_state = [3;3];
    k_velocity = [10;10];

    prev_state001 = LSE.var001(:,iter,3);
    prev_velocity001 = (LSE.var001(:,iter,3)-LSE.var001(:,iter,2))./dt;
    vec_processNoise.var001(:,iter) = k_state - F*prev_state001 - prev_velocity001.*dt;
    wwT001(:,:,iter) = vec_processNoise.var001(:,iter)*vec_processNoise.var001(:,iter)';

    prev_state01 = LSE.var01(:,iter,3);
    prev_velocity01 = (LSE.var01(:,iter,3)-LSE.var01(:,iter,2))./dt;
    vec_processNoise.var01(:,iter) = k_state - F*prev_state01 - prev_velocity01.*dt;
    wwT01(:,:,iter) = vec_processNoise.var01(:,iter)*vec_processNoise.var01(:,iter)';

    prev_state1 = LSE.var1(:,iter,3);
    prev_velocity1 = (LSE.var1(:,iter,3)-LSE.var1(:,iter,2))./dt;
    vec_processNoise.var1(:,iter) = k_state - F*prev_state1 - prev_velocity1.*dt;
    wwT1(:,:,iter) = vec_processNoise.var1(:,iter)*vec_processNoise.var1(:,iter)';

    prev_state10 = LSE.var10(:,iter,3);
    prev_velocity10 = (LSE.var10(:,iter,3)-LSE.var10(:,iter,2))./dt;
    vec_processNoise.var10(:,iter) = k_state - F*prev_state10 - prev_velocity10.*dt;
    wwT10(:,:,iter) = vec_processNoise.var10(:,iter)*vec_processNoise.var10(:,iter)';

    prev_state100 = LSE.var100(:,iter,3);
    prev_velocity100 = (LSE.var100(:,iter,3)-LSE.var100(:,iter,2))./dt;
    vec_processNoise.var100(:,iter) = k_state - F*prev_state100 - prev_velocity100.*dt;
    wwT100(:,:,iter) = vec_processNoise.var100(:,iter)*vec_processNoise.var100(:,iter)';

    eeT001(:,:,iter) = LSE.var001(:,iter,1)*LSE.var001(:,iter,1)';
    eeT01(:,:,iter) = LSE.var01(:,iter,1)*LSE.var01(:,iter,1)';
    eeT1(:,:,iter) = LSE.var1(:,iter,1)*LSE.var1(:,iter,1)';
    eeT10(:,:,iter) = LSE.var10(:,iter,1)*LSE.var10(:,iter,1)';
    eeT100(:,:,iter) = LSE.var100(:,iter,1)*LSE.var100(:,iter,1)';

end
Rmean = struct(...
    'var001',mean(R.var001,3),...
    'var01',mean(R.var01,3),...
    'var1',mean(R.var1,3),...
    'var10',mean(R.var10,3),...
    'var100',mean(R.var100,3)...
    );
Rconst = struct(...
    'var001',mean(R.var001,[3,4]),...
    'var01',mean(R.var01,[3,4]),...
    'var1',mean(R.var1,[3,4]),...
    'var10',mean(R.var10,[3,4]),...
    'var100',mean(R.var100,[3,4])...
    );
Q = struct(...
    'var001', (mean(wwT001,3) - mean(vec_processNoise.var001,2)*mean(vec_processNoise.var001,2)'),...
    'var01', (mean(wwT01,3) - mean(vec_processNoise.var01,2)*mean(vec_processNoise.var01,2)'),...
    'var1', (mean(wwT1,3) - mean(vec_processNoise.var1,2)*mean(vec_processNoise.var1,2)'),...
    'var10', (mean(wwT10,3) - mean(vec_processNoise.var10,2)*mean(vec_processNoise.var10,2)'),...
    'var100', (mean(wwT100,3) - mean(vec_processNoise.var100,2)*mean(vec_processNoise.var100,2)')...
    );
P = struct(...
    'var001', (mean(eeT001,3)-mean(LSE.var001(:,:,1),2)*mean(LSE.var001(:,:,1),2)'),...
    'var01', (mean(eeT01,3)-mean(LSE.var01(:,:,1),2)*mean(LSE.var01(:,:,1),2)'),...
    'var1', (mean(eeT1,3)-mean(LSE.var1(:,:,1),2)*mean(LSE.var1(:,:,1),2)'),...
    'var10', (mean(eeT10,3)-mean(LSE.var10(:,:,1),2)*mean(LSE.var10(:,:,1),2)'),...
    'var100', (mean(eeT100,3)-mean(LSE.var100(:,:,1),2)*mean(LSE.var100(:,:,1),2)')...
    );
meanSysnoise = struct('var001',mean(vec_processNoise.var001,2),...
    'var01',mean(vec_processNoise.var01,2),...
    'var1',mean(vec_processNoise.var1,2),...
    'var10',mean(vec_processNoise.var10,2),...
    'var100',mean(vec_processNoise.var100,2)...
    );

save('Rmean.mat',"Rmean");
save('Rconst.mat',"Rconst");
save('Z.mat',"Z");
save('LSE.mat','LSE');
save("Q.mat","Q");
save("P.mat","P");
save('meanSysnoise.mat','meanSysnoise');
end